<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>채팅 UI 테스트</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
        }
        
        .chat-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .chat-header {
            background: #3b82f6;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .chat-messages {
            height: 400px;
            overflow-y: auto;
            padding: 20px;
            background: #f9f9f9;
        }
        
        .message-pair {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .role-label {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .teacher-label { color: #3b82f6; }
        .student-label { color: #10b981; }
        
        .message {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .teacher-original {
            background: #e0f2fe;
            border-left: 4px solid #3b82f6;
        }
        
        .student-transformed {
            background: #d1fae5;
            border-left: 4px solid #10b981;
        }
        
        .transformation-indicator {
            font-size: 12px;
            color: #059669;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .message-meta {
            font-size: 12px;
            color: #6b7280;
            margin-top: 5px;
        }
        
        .chat-input {
            display: flex;
            padding: 20px;
            border-top: 1px solid #e5e7eb;
        }
        
        .message-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 5px;
            margin-right: 10px;
            font-size: 14px;
            resize: vertical;
        }
        
        .send-button {
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .send-button:hover {
            background: #2563eb;
        }
        
        .send-button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .debug-info {
            background: #f3f4f6;
            padding: 10px;
            margin: 10px 20px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h2>AI 페르소나 매칭 채팅 테스트</h2>
            <p>전송 버튼 및 이벤트 리스너 테스트</p>
        </div>
        
        <div class="debug-info" id="debugInfo">
            대기 중...
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <!-- 샘플 메시지 -->
            <div class="message-pair">
                <div class="role-label teacher-label">선생님 (원본)</div>
                <div class="message teacher-original">
                    <div>오늘 수학 시험 준비 잘 하고 있니? 문제집 풀이는 다 끝냈어?</div>
                    <div class="message-meta">15:30:45</div>
                </div>
                
                <div class="role-label student-label">학생에게 전달 (AI 변환)</div>
                <div class="message student-transformed">
                    <div class="transformation-indicator">AI 변환됨</div>
                    <div>수학시험 준비 상황을 점검해볼까요? 문제집 진도는 어느 정도 나갔는지 알려주세요.</div>
                    <div class="message-meta">15:30:45 • 전달 완료</div>
                </div>
            </div>
        </div>
        
        <div class="chat-input">
            <textarea 
                id="messageInput" 
                class="message-input" 
                placeholder="메시지를 입력하세요... (Enter로 전송, Shift+Enter로 줄바꿈)"
                rows="1"></textarea>
            <button id="sendButton" class="send-button" onclick="sendMessage()">전송</button>
        </div>
    </div>

    <script>
        let messageCount = 0;
        
        // 디버그 정보 업데이트
        function updateDebug(message) {
            const debugInfo = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.innerHTML += `[${timestamp}] ${message}<br>`;
            debugInfo.scrollTop = debugInfo.scrollHeight;
        }
        
        // 메시지 전송 - 전역 함수로 정의
        window.sendMessage = async function() {
            updateDebug('sendMessage 함수 호출됨');
            
            const messageInput = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            
            if (!messageInput || !sendButton) {
                updateDebug('❌ 메시지 입력창 또는 전송 버튼을 찾을 수 없습니다');
                alert('페이지 요소를 찾을 수 없습니다. 페이지를 새로고침해보세요.');
                return;
            }
            
            const message = messageInput.value.trim();
            updateDebug(`입력된 메시지: "${message}"`);
            
            if (!message) {
                updateDebug('❌ 빈 메시지는 전송할 수 없습니다');
                return;
            }
            
            messageInput.value = '';
            sendButton.disabled = true;
            sendButton.textContent = '변환 중...';
            
            updateDebug('⏳ 메시지 처리 중...');
            
            try {
                // 실제 서버 전송 대신 시뮬레이션
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // 시뮬레이션된 변환 메시지
                const transformedMessage = `[AI 변환] ${message}`;
                
                // 메시지 쌍 추가
                addMessagePairToChat(message, transformedMessage);
                updateDebug('✅ 메시지 전송 완료');
                
            } catch (error) {
                updateDebug('❌ 오류 발생: ' + error.message);
                alert('오류가 발생했습니다: ' + error.message);
            } finally {
                sendButton.disabled = false;
                sendButton.textContent = '전송';
                updateDebug('🔄 버튼 상태 복원');
            }
        }
        
        // 메시지 쌍 추가 (선생님 원본 + 학생용 변환)
        function addMessagePairToChat(originalMessage, transformedMessage) {
            messageCount++;
            const chatMessages = document.getElementById('chatMessages');
            const messagePairElement = document.createElement('div');
            messagePairElement.className = 'message-pair';
            
            const timestamp = new Date().toLocaleTimeString();
            
            messagePairElement.innerHTML = `
                <div class="role-label teacher-label">선생님 (원본) #${messageCount}</div>
                <div class="message teacher-original">
                    <div>${originalMessage}</div>
                    <div class="message-meta">${timestamp}</div>
                </div>
                
                <div class="role-label student-label">학생에게 전달 (AI 변환)</div>
                <div class="message student-transformed">
                    <div class="transformation-indicator">AI 변환됨</div>
                    <div>${transformedMessage}</div>
                    <div class="message-meta">${timestamp} • 전달 완료</div>
                </div>
            `;
            
            chatMessages.appendChild(messagePairElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            updateDebug(`💬 메시지 쌍 #${messageCount} 추가됨`);
        }
        
        // 페이지 로드 시 초기화
        window.addEventListener('load', function() {
            updateDebug('🚀 페이지 로드 완료');
            
            // Enter 키 이벤트 리스너 설정
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                messageInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        updateDebug('⌨️ Enter 키로 전송 시도');
                        sendMessage();
                    }
                });
                updateDebug('✅ Enter 키 이벤트 리스너 설정 완료');
            } else {
                updateDebug('❌ messageInput 요소를 찾을 수 없습니다');
            }
            
            // 전송 버튼 이벤트 리스너도 추가
            const sendButton = document.getElementById('sendButton');
            if (sendButton) {
                updateDebug('✅ 전송 버튼 찾음');
                sendButton.addEventListener('click', function() {
                    updateDebug('🖱️ 전송 버튼 클릭됨 (addEventListener)');
                    sendMessage();
                });
                updateDebug('✅ 전송 버튼 이벤트 리스너 설정 완료');
            } else {
                updateDebug('❌ sendButton 요소를 찾을 수 없습니다');
            }
            
            updateDebug('🎉 초기화 완료 - 테스트 메시지를 입력해보세요!');
        });
        
        // onclick 속성도 테스트
        updateDebug('📝 onclick 속성으로 sendMessage 함수 연결됨');
    </script>
</body>
</html>